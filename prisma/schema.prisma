/* ===============================
   GENERATOR
================================ */
generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

/* ===============================
   DATASOURCE
================================ */
datasource db {
  provider = "postgresql"
}

/* ===============================
   ENUMS
================================ */
enum Role {
  MEMBER
  ADMIN
}

/* ===============================
   MODELS
================================ */

/* ---------- AGENT ---------- */
model Agent {
  id       Int     @id @default(autoincrement())
  name     String  @unique
  url      String
  mensagem String?

  wabas    Waba[]

  @@map("agent")
}

/* ---------- WABA ---------- */
model Waba {
  id                  Int    @id @default(autoincrement())
  phoneNumberId       String @unique
  displayPhoneNumber  String @unique

  qtdContatos         Int?   @default(0)
  qtdConversao        Int?   @default(0)

  organizationId      String
  agentId             Int

  agent    Agent     @relation(fields: [agentId], references: [id], onDelete: Cascade)
  contactWabas ContactWaba[]
  @@map("waba")
}

/* ---------- CONTACT ---------- */
model Contact {
  id                     Int      @id @default(autoincrement())
  email                  String?
  name                   String?
  phone                  String   @unique

  startDateConversation  DateTime @default(now())
  lastDateConversation   DateTime?

  leadGoal               String?
  contactWabas ContactWaba[]
  @@map("contact")
}

model ContactWaba {
  id        Int @id @default(autoincrement())

  contactId Int
  wabaId    Int

  contact Contact @relation(fields: [contactId], references: [id], onDelete: Cascade)
  waba    Waba   @relation(fields: [wabaId], references: [id], onDelete: Cascade)

  @@map("contact_waba")
}

/* ---------- RD STATION ---------- */
model Rdstation {
  id            Int    @id @default(autoincrement())
  name          String @unique

  access_token  String
  token_type    String
  expires_in    Int

  refresh_token String @unique
  expires_at    DateTime?

  @@map("rdstation")
}